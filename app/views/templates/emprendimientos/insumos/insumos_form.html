{% extends 'layout.html' %}

{% block css %}
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" />
{% endblock %}

{% block content %}

<!--Navbar -->
<nav class="mb-1 navbar navbar-expand-lg navbar-dark secondary-color">
    <p class="navbar-brand" style="cursor: default;" href="{{ url_for('views.emprendimientos_views.emprendimiento_home', id=emprendimiento.id_) }}">{{emprendimiento.nombre}}</p>
    <div class="collapse navbar-collapse" id="navbarSupportedContent-333">
        <ul class="navbar-nav mr-auto">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('views.productos_views.productos') }}">Productos</a>
        </li>
        <li class="nav-item active">
            <a class="nav-link" href="{{ url_for('views.insumos_views.insumos') }}">Insumos</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('views.proveedores_views.proveedores') }}">Proveedores y Pedidos</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('views.costos_views.costos') }}">Costos</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('views.ventas_views.crear_ventas') }}">Ventas</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('views.clientes_views.clientes') }}">Clientes</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('views.informes_views.informes') }}">Informes y Estadísticas</a>
        </li>
        </ul>
        <ul class="navbar-nav ml-auto nav-flex-icons">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-333" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            Mi cuenta <i class="fas fa-user"></i>
            </a>
            <div class="dropdown-menu dropdown-menu-right dropdown-default" aria-labelledby="navbarDropdownMenuLink-333">
            <a class="dropdown-item" href="{{ url_for('views.usuarios_views.editar') }}">Mi usuario</a>
            <a class="dropdown-item" href="{{ url_for('views.emprendimientos_views.emprendimientos') }}">Mis emprendimientos</a>
            <a class="dropdown-item" href="{{ url_for('views.usuarios_views.login') }}">Cerrar sesión</a>
            </div>
        </li>
        </ul>
    </div>
</nav>

<div class="container">

    <h3>{{title}}</h3>

    <br>

    <div class="row justify-content-center main">
        <form class="main-form" method="POST" action="{{ url_for('api.insumos_api.insumo_dispatcher') }}" enctype="multipart/form-data">
            <input  type="hidden" name="_method"  value="{{method}}"/>
            <input  type="hidden" name="id_"  value="{{insumo.id_}}"/>
            
            <div class="row d-flex justify-content-center align-items-center flex-row">
                <div class="md-form col-5">
                    <label class="form-label">Nombre</label>
                    <input class="form-control" type="text" name="nombre" value="{{insumo.nombre or ''}}" required />
                </div>
                <div class="form-row col-4">
                    <select class="form-control" name="id_proveedor" id="id_proveedor" required>
                        <option value="" selected disabled>Elegir proveedor</option>
                        {% for proveedor in proveedores %}
                        <option value="{{proveedor.id_}}" {% if proveedor.id_ == insumo.id_proveedor %} selected="selected" {% endif %}>{{proveedor.nombre}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="md-form col-3">
                    <label class="form-label">Costo de compra</label>
                    <input class="form-control" type="number" name="costo" value={{insumo.costo}} required />
                </div>
            </div>

            <hr>
            
            <div class="row d-flex justify-content-center align-items-center flex-row">
                <div class="md-form col-3">
                    <label class="form-label">Unidad de medida</label>
                    <input class="form-control" type="text" name="unidad" value="{{insumo.unidad or ''}}" onkeyup='writeUnidad(this.value);' placeholder="Ej. Mililitros" required />
                </div>
                <div class="md-form col-3">
                    <label class="form-label">Presentación</label>
                    <input class="form-control" type="text" name="presentacion" value="{{insumo.presentacion or ''}}" placeholder="Ej. Botella" onfocusout='aclararStock(this.value);' required />
                </div>
                <div class="md-form col-1">
                    de
                </div>
                <div class="md-form col-2">
                    <input class="form-control" type="number" name="medida_presentacion" value={{insumo.medida_presentacion}} required />
                </div>
                <div class="md-form col-3">
                    <p name="unidad_medida_presentacion">{{insumo.unidad or 'medida'}}</p>
                </div>
            </div>

            <hr>

            <div class="row">
                <p id="aclaracionStock">Stock</p>
            </div>

            <div class="row d-flex justify-content-center align-items-center flex-row">
                <div class="md-form col-4">
                    <label class="form-label">Stock actual</label>
                    <input class="form-control" type="number" name="stock_actual" value={{insumo.stock_actual}} min=0 required />
                </div>
                <div class="md-form col-4">
                    <label class="form-label">Stock mínimo</label>
                    <input class="form-control" type="number" name="stock_minimo" value={{insumo.stock_minimo}} min=0 required />    
                </div>
            </div>   

            <hr>
 
            <div class="row md-form">
                <button class="form-submit btn btn-primary .btn-sm" id="finalizar" type="submit">{{title}}</button>
            </div>
            
        </form>
    </div>

</div>

<div class="modal fade" id="modal-insumos-form" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body" id="flashes">
            {% with messages = get_flashed_messages() %}
            {% if messages %}
            <ul>
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
            </ul>
            {% endif %}
            {% endwith %}
        </div>
        </div>
    </div>
</div>

{% endblock %}

{% block js %}
    <script src="{{ url_for('static', filename='js/insumos.js') }}"></script>
{% endblock %}
